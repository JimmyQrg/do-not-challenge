<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DO NOT CHALLENGE</title>
<link rel="icon" type="image/png" href="icon.png">
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body {
  margin: 0;
  overflow: hidden;
  font-family: 'Press Start 2P', cursive;
  color: #fff;
  background: url('background.png') no-repeat center center fixed;
  background-size: cover;
}

/* UI and buttons */
#startUI, #gameUI, #endUI {
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 20px;
  transition: opacity 0.5s ease;
}
button {
  font-family: 'Press Start 2P', cursive;
  font-size: 18px;
  padding: 12px 20px;
  background: #222;
  border: 2px solid #fff;
  border-radius: 8px;
  color: #fff;
  cursor: pointer;
  transition: all 0.2s ease;
}
button:hover {
  background: #fff;
  color: #222;
  transform: scale(1.05);
  box-shadow: 0 0 15px #0ff, 0 0 25px #0ff inset;
}

/* Language selector */
#languageSelector {
  position: absolute;
  top: 10px;
  right: 10px;
  display:flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
}
#languageSelector img { width:32px; height:32px; }

/* Player card */
#playerCard {
  width: 400px;
  height: 200px;
  perspective: 1000px;
  cursor: pointer;
}
.card-inner {
  width: 100%;
  height: 100%;
  transition: transform 0.8s;
  transform-style: preserve-3d;
  position: relative;
}
.card-inner.flipped { transform: rotateY(180deg); }
.card-front, .card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  display:flex;
  align-items: center;
  justify-content: center;
  border: 3px solid #fff;
  border-radius: 12px;
  font-size: 16px;
  text-align: center;
  padding: 20px;
  box-sizing: border-box;
}
.card-front { background: #333; }
.card-back { 
  background: #111;
  transform: rotateY(180deg);
  font-size: 18px;
}

#continueBtn { display:none; }

/* End UI */
#endUI {
  flex-wrap: wrap;
  gap: 15px;
  padding: 20px;
  justify-content: center;
  align-content: flex-start;
  overflow-y: auto;
}
.playerBox {
  width: 100px;
  height: 100px;
  background: #444;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
  border:2px solid #fff;
  cursor:pointer;
  transition: all 0.3s ease;
}
.playerBox.dead { background:red; }
.playerBox.winner { background:green; }
</style>
</head>
<body>

<!-- Language Selector -->
<div id="languageSelector">
  <img src="globe.png" alt="Globe">
  <select id="languageSelect">
    <option value="en">English</option>
    <option value="zh">中文（简体）</option>
    <option value="jp">日本語</option>
  </select>
</div>

<!-- Start UI -->
<div id="startUI">
  <h1 id="gameTitle">DO NOT CHALLENGE</h1>
  <label for="playerCount">Players:</label>
  <input type="number" id="playerCount" min="2" max="20" value="2">
  <button id="startBtn">START</button>
  <button id="howToBtn">HOW TO PLAY</button>
</div>

<!-- Game UI -->
<div id="gameUI" style="opacity:0; pointer-events:none;">
  <h2 id="playerLabel">Player 1</h2>
  <div id="playerCard">
    <div class="card-inner">
      <div class="card-front"><span>Click to reveal rule</span></div>
      <div class="card-back"><span></span></div>
    </div>
  </div>
  <button id="continueBtn">CONTINUE</button>
</div>

<!-- End UI -->
<div id="endUI" style="opacity:0; pointer-events:none;">
  <h2 id="endTitle">CLICK PLAYER TO CONFIRM DEATH</h2>
</div>

<script src="cardInfo-howToPlay.js"></script>
<script>
let currentLang = 'en';
let totalPlayers = 2;
let currentPlayer = 0;
let playerRules = [];
let playerStates = [];
let viewingCard = null; // Track right-click view

const startUI = document.getElementById('startUI');
const gameUI = document.getElementById('gameUI');
const endUI = document.getElementById('endUI');

const startBtn = document.getElementById('startBtn');
const howToBtn = document.getElementById('howToBtn');
const playerCountInput = document.getElementById('playerCount');

const playerLabel = document.getElementById('playerLabel');
const playerCardInner = document.querySelector('.card-inner');
const cardBackText = document.querySelector('.card-back span');
const continueBtn = document.getElementById('continueBtn');

const languageSelect = document.getElementById('languageSelect');

function shuffle(array){ return array.sort(()=>Math.random()-0.5); }

function startGame(){
  totalPlayers = Number(playerCountInput.value);
  currentPlayer = 0;
  playerRules = [];
  playerStates = Array(totalPlayers).fill('alive');
  const shuffledRules = shuffle([...cardData]);
  for(let i=0;i<totalPlayers;i++){ playerRules.push(shuffledRules[i % shuffledRules.length]); }
  startUI.style.opacity=0;
  startUI.style.pointerEvents='none';
  gameUI.style.opacity=1;
  gameUI.style.pointerEvents='auto';
  showPlayer(currentPlayer);
}

function showPlayer(index){
  playerLabel.textContent = currentLang==='en'?`Player ${index+1}`:currentLang==='zh'?`${index+1}号玩家`:`プレイヤー${index+1}`;
  playerCardInner.classList.remove('flipped');
  cardBackText.textContent='';
  continueBtn.style.display='none';
  viewingCard = null;
}

// Left-click reveal
playerCardInner.addEventListener('click',()=>{
  if(viewingCard === currentPlayer) return; // disable if viewing
  if(playerCardInner.classList.contains('flipped')) return;
  playerCardInner.classList.add('flipped');
  const rule = playerRules[currentPlayer][currentLang];
  cardBackText.textContent = rule;
  continueBtn.style.display='inline-block';
});

// Right-click view
playerCardInner.addEventListener('contextmenu', (e) => {
  e.preventDefault();
  if(viewingCard === currentPlayer){
    playerCardInner.classList.remove('flipped');
    cardBackText.textContent = '';
    playerLabel.textContent = currentLang==='en'?`Player ${currentPlayer+1}`:currentLang==='zh'?`${currentPlayer+1}号玩家`:`プレイヤー${currentPlayer+1}`;
    viewingCard = null;
    return;
  }
  playerCardInner.classList.add('flipped');
  const rule = playerRules[currentPlayer][currentLang];
  cardBackText.textContent = rule;
  playerLabel.textContent = currentLang==='en'?`Viewing Player ${currentPlayer+1}'s Rule`:currentLang==='zh'?`查看 ${currentPlayer+1}号玩家的规则`:`プレイヤー${currentPlayer+1}のルールを表示中`;
  viewingCard = currentPlayer;
});

continueBtn.addEventListener('click',()=>{
  currentPlayer++;
  if(currentPlayer>=totalPlayers){ endGame(); } else { showPlayer(currentPlayer); }
});

function endGame(){
  gameUI.style.opacity=0;
  gameUI.style.pointerEvents='none';
  endUI.style.opacity=1;
  endUI.style.pointerEvents='auto';
  endUI.innerHTML=`<h2 id="endTitle">${currentLang==='en'?'CLICK PLAYER TO CONFIRM DEATH':currentLang==='zh'?'点击方块杀死玩家':'プレイヤーをクリックして死亡確認'}</h2>`;
  for(let i=0;i<totalPlayers;i++){
    const box=document.createElement('div');
    box.classList.add('playerBox');
    box.textContent=i+1;
    box.addEventListener('click',()=>{
      if(box.classList.contains('dead')) return;
      box.classList.add('dead');
      checkWinner();
    });
    endUI.appendChild(box);
  }
}

function checkWinner(){
  const alive = Array.from(document.querySelectorAll('.playerBox')).filter(b=>!b.classList.contains('dead'));
  if(alive.length===1){
    const winnerBox = alive[0];
    winnerBox.classList.add('winner');
    const boxes = document.querySelectorAll('.playerBox');
    boxes.forEach((b,i)=>{ b.textContent = playerRules[i][currentLang]; });
    const replayBtn=document.createElement('button');
    replayBtn.textContent = currentLang==='en'?'REPLAY':currentLang==='zh'?'再玩一局':'リプレイ';
    replayBtn.addEventListener('click',()=>location.reload());
    endUI.appendChild(replayBtn);
  }
}

// Language selector
languageSelect.addEventListener('change',(e)=>{
  currentLang = e.target.value;
  startBtn.textContent = currentLang==='en'?'START':currentLang==='zh'?'开始':'スタート';
  howToBtn.textContent = currentLang==='en'?'HOW TO PLAY':currentLang==='zh'?'游戏规则':'遊び方';
  if(currentPlayer<totalPlayers) showPlayer(currentPlayer);
});

// Start and HowTo buttons
startBtn.addEventListener('click', startGame);
howToBtn.addEventListener('click', ()=>{
  window.open('howtoplay.html','_blank') || alert('Please view howtoplay.html for instructions.');
});
</script>

</body>
</html>
